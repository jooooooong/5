import streamlit as st
import pandas as pd
import plotly.express as px

# -------------------------------
# ğŸ“‚ ì‚¬ì´ë“œë°” ë©”ë‰´ êµ¬ì„±
# -------------------------------
st.sidebar.title("ğŸ“‚ ë¶„ì„ í˜ì´ì§€")
page = st.sidebar.radio("í•­ëª© ì„ íƒ", ["ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë³€í™”", "ì—…ì¢…ë³„ ì í¬ ìˆ˜ ë³€í™”", "ì†Œë¹„ ë¶„ì„ ë° ì „ëµ ì œì•ˆ"])

# ===============================
# 1. ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë³€í™”
# ===============================
if page == "ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë³€í™”":
    st.title("ğŸ“Š ì–‘ì£¼2ë™ ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë³€í™” ë¶„ì„ (2008â€“2024)")

    csv_url = "https://raw.githubusercontent.com/jooooooong/5/main/population(in)%20(1).csv?raw=true"
    try:
        df = pd.read_csv(csv_url)
    except:
        st.error("âŒ CSV íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        st.stop()

    df.rename(columns={df.columns[0]: 'ì—°ë„'}, inplace=True)
    df_melted = df.melt(id_vars='ì—°ë„', var_name='ì—°ë ¹ëŒ€', value_name='ì¸êµ¬ìˆ˜')
    df_melted['ì¸êµ¬ìˆ˜'] = df_melted['ì¸êµ¬ìˆ˜'].astype(str).str.replace(',', '').astype(int)

    ì—°ë ¹ëŒ€ëª©ë¡ = sorted(df_melted['ì—°ë ¹ëŒ€'].unique())
    ì„ íƒì—°ë ¹ëŒ€ = st.multiselect("ğŸ” ë¶„ì„í•  ì—°ë ¹ëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš”:", ì—°ë ¹ëŒ€ëª©ë¡, default=ì—°ë ¹ëŒ€ëª©ë¡)
    í•„í„°ëœ = df_melted[df_melted['ì—°ë ¹ëŒ€'].isin(ì„ íƒì—°ë ¹ëŒ€)]

    fig = px.line(í•„í„°ëœ, x='ì—°ë„', y='ì¸êµ¬ìˆ˜', color='ì—°ë ¹ëŒ€', markers=True,
                  title="ğŸ“ˆ ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë³€í™” ì¶”ì´", labels={'ì—°ë„': 'ì—°ë„', 'ì¸êµ¬ìˆ˜': 'ì¸êµ¬ ìˆ˜'})
    st.plotly_chart(fig, use_container_width=True)

# ===============================
# 2. ì—…ì¢…ë³„ ì í¬ ìˆ˜ ë³€í™”
# ===============================
elif page == "ì—…ì¢…ë³„ ì í¬ ìˆ˜ ë³€í™”":
    st.title("ğŸª ì–‘ì£¼2ë™ ì „ì²´ ì í¬ ìˆ˜ ë³€í™” (2018â€“2023)")

    df = pd.DataFrame({
        "ì—°ë„": [2018, 2019, 2020, 2021, 2022, 2023],
        "ì „ì²´ì í¬ìˆ˜": [516, 556, 572, 588, 591, 610]
    })

    fig = px.bar(df, x='ì—°ë„', y='ì „ì²´ì í¬ìˆ˜', text='ì „ì²´ì í¬ìˆ˜',
                 title="ì–‘ì£¼2ë™ ì „ì²´ ì í¬ ìˆ˜ ì¶”ì´", labels={'ì „ì²´ì í¬ìˆ˜': 'ì í¬ ìˆ˜'})
    fig.update_traces(textposition='outside')
    st.plotly_chart(fig, use_container_width=True)

# ===============================
# 3. ì†Œë¹„ ë¶„ì„ ë° ì „ëµ ì œì•ˆ
# ===============================
elif page == "ì†Œë¹„ ë¶„ì„ ë° ì „ëµ ì œì•ˆ":
    st.title("ğŸ’¸ ì—°ë ¹ëŒ€ë³„ ì†Œë¹„ íŠ¹ì„±ê³¼ íšŒë³µ ì „ëµ")

    # ì¸êµ¬ êµ¬ì„±ë¹„ ë³€í™”
    st.subheader("ğŸ“ˆ ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ êµ¬ì„±ë¹„ ë³€í™” (2008 â†’ 2024)")
    pop_data = {
        "ì—°ë ¹ëŒ€": ["ìœ ì•„Â·ì•„ë™ì¸µ (0~14ì„¸)", "ì²­ì†Œë…„ì¸µ (15~19ì„¸)", "ì²­ë…„ì¸µ (20~34ì„¸)", "ì¤‘ë…„ì¸µ (35~54ì„¸)", "ì¥ë…„ì¸µ (55~64ì„¸)", "ë…¸ë…„ì¸µ (65ì„¸ ì´ìƒ)"],
        "2008": [25.20, 4.33, 21.49, 33.81, 7.69, 7.48],
        "2024": [12.30, 6.61, 15.99, 31.90, 14.73, 18.47]
    }
    df_pop = pd.DataFrame(pop_data)
    df_melted = df_pop.melt(id_vars="ì—°ë ¹ëŒ€", var_name="ì—°ë„", value_name="êµ¬ì„±ë¹„")

    fig = px.bar(df_melted, x="ì—°ë ¹ëŒ€", y="êµ¬ì„±ë¹„", color="ì—°ë„",
                 barmode="group", title="ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ êµ¬ì„±ë¹„ ë³€í™” (%)")
    st.plotly_chart(fig, use_container_width=True)

    # ì†Œë¹„ ë°ì´í„°
    st.subheader("ğŸ›ï¸ ì—°ë ¹ëŒ€ë³„ ì—…ì¢… ì†Œë¹„ ê¸ˆì•¡ (ë‹¨ìœ„: ì–µì›)")
    df_consume = pd.DataFrame({
        "ì—°ë ¹ëŒ€": ["20ëŒ€", "30ëŒ€", "40ëŒ€", "50ëŒ€", "60ëŒ€"],
        "ì¢…í•©ì†Œë§¤ì ": [0.83, 1.95, 4.47, 5.11, 2.92],
        "í•œì‹": [0.41, 1.34, 2.41, 2.68, 1.49],
        "ì—°ë£ŒíŒë§¤": [0.71, 2.17, 4.17, 4.48, 2.38],
        "ê°€ì „ì œí’ˆ": [0.62, None, 1.99, None, 1.10],
        "ìŒ/ì‹ë£Œí’ˆì†Œë§¤": [None, 0.77, 2.12, 2.60, 1.89],
        "ì¼ë°˜ë³‘ì›": [None, None, None, 1.54, None]
    }).fillna(0)
    df_c = df_consume.melt(id_vars="ì—°ë ¹ëŒ€", var_name="ì—…ì¢…", value_name="ì†Œë¹„ê¸ˆì•¡(ì–µì›)")

    fig2 = px.bar(df_c, x="ì—…ì¢…", y="ì†Œë¹„ê¸ˆì•¡(ì–µì›)", color="ì—°ë ¹ëŒ€", barmode="group")
    fig2.update_layout(xaxis_tickangle=-45)
    st.plotly_chart(fig2, use_container_width=True)

    # ì „ëµ ì œì•ˆ
    st.subheader("âœ… íšŒë³µ ì „ëµ ìš”ì•½")

    st.markdown("""
    - **ğŸ‘´ ì¦ê°€í•œ ì—°ë ¹ì¸µ:** ì¥ë…„ì¸µ, ë…¸ë…„ì¸µ â†’ ê±´ê°•, í•„ìˆ˜ì†Œë¹„, í¸ì˜ì‹œì„¤ ì—…ì¢… í™•ëŒ€ í•„ìš”  
    - **ğŸ‘¶ ê°ì†Œí•œ ì—°ë ¹ì¸µ:** ìœ ì•„, ì²­ë…„ì¸µ â†’ êµìœ¡, ë†€ì´ì‹œì„¤, ì²­ë…„íŠ¸ë Œë“œ ì—…ì¢… ì¶•ì†Œ ìš°ë ¤  
    - **ì¶”ì²œ ì—…ì¢…:**  
        - ë³‘ì›, ì•½êµ­, ì‹¤ë²„ì¹´í˜, ê²½ë¡œë‹¹, ê±´ê°•ì‹í’ˆì   
        - í¸ì˜ì , ìŒì‹ì (í•œì‹), ëŒ€í˜•ë§ˆíŠ¸  
        - ê³µê³µ ë„ì„œê´€, ë³µí•©ë¬¸í™”ê³µê°„, êµí†µ ì ‘ê·¼ì„± ê°•í™”
    """)

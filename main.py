import streamlit as st
import pandas as pd
import plotly.express as px

# -------------------------------
# 1. í˜ì´ì§€ ì œëª© ë° ì„¤ëª…
# -------------------------------
st.title("ğŸ“Š ì–‘ì£¼2ë™ ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë³€í™” ë¶„ì„ (2008â€“2024)")

st.markdown("""
ì´ ì›¹ì•±ì€ GitHubì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬  
ì–‘ì£¼2ë™ì˜ ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ êµ¬ì¡° ë³€í™”ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.
""")

# -------------------------------
# 2. GitHub CSV íŒŒì¼ ê²½ë¡œ
# ğŸ“Œ ì•„ë˜ URLì„ ë³¸ì¸ì˜ GitHub íŒŒì¼ì— ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš”
# -------------------------------
csv_url = "https://raw.githubusercontent.com/your-username/your-repo/main/data/population(in)%20(1).csv"

# -------------------------------
# 3. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
# -------------------------------
try:
    df = pd.read_csv(csv_url)
except Exception as e:
    st.error("âŒ CSV íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. URLì„ í™•ì¸í•˜ì„¸ìš”.")
    st.stop()

# -------------------------------
# 4. ë°ì´í„° ì „ì²˜ë¦¬
# -------------------------------
# ì²« ë²ˆì§¸ ì—´ ì´ë¦„ì´ ë³´í†µ 'Unnamed: 0' â†’ 'ì—°ë„'ë¡œ ë°”ê¿”ì£¼ê¸°
df.rename(columns={df.columns[0]: 'ì—°ë„'}, inplace=True)

# 'ê°€ë¡œí˜• ë°ì´í„°'ë¥¼ 'ì„¸ë¡œí˜• ë°ì´í„°'ë¡œ ë³€í™˜
df_melted = df.melt(id_vars='ì—°ë„', var_name='ì—°ë ¹ëŒ€', value_name='ì¸êµ¬ìˆ˜')

# ì‰¼í‘œ ì œê±° ë° ìˆ«ìí˜• ë³€í™˜
df_melted['ì¸êµ¬ìˆ˜'] = df_melted['ì¸êµ¬ìˆ˜'].astype(str).str.replace(',', '').astype(int)

# -------------------------------
# 5. ì—°ë ¹ëŒ€ ì„ íƒ UI
# -------------------------------
ì—°ë ¹ëŒ€ëª©ë¡ = sorted(df_melted['ì—°ë ¹ëŒ€'].unique())

ì„ íƒì—°ë ¹ëŒ€ = st.multiselect(
    "ğŸ” ë¶„ì„í•  ì—°ë ¹ëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš”:",
    ì—°ë ¹ëŒ€ëª©ë¡,
    default=ì—°ë ¹ëŒ€ëª©ë¡
)

# ì„ íƒëœ ì—°ë ¹ëŒ€ë§Œ í•„í„°ë§
í•„í„°ëœë°ì´í„° = df_melted[df_melted['ì—°ë ¹ëŒ€'].isin(ì„ íƒì—°ë ¹ëŒ€)]

# -------------------------------
# 6. ì‹œê°í™” (Plotly Line Chart)
# -------------------------------
fig = px.line(
    í•„í„°ëœë°ì´í„°,
    x='ì—°ë„',
    y='ì¸êµ¬ìˆ˜',
    color='ì—°ë ¹ëŒ€',
    markers=True,
    labels={'ì—°ë„': 'ì—°ë„', 'ì¸êµ¬ìˆ˜': 'ì¸êµ¬ ìˆ˜', 'ì—°ë ¹ëŒ€': 'ì—°ë ¹ëŒ€'},
    title="ğŸ“ˆ ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë³€í™” ì¶”ì´ (2008â€“2024)"
)

fig.update_layout(height=550, xaxis=dict(dtick=1), legend_title_text='ì—°ë ¹ëŒ€')

st.plotly_chart(fig, use_container_width=True)
